// Generated by CoffeeScript 1.11.1
var async, log, parentFolders, timeout;

async = require('async');

log = require('printit')({
  prefix: 'updateParents'
});

parentFolders = {};

timeout = null;

module.exports.add = function(folder, lastModification) {
  var fullpath;
  folder.lastModification = lastModification;
  fullpath = folder.path + "/" + folder.name;
  parentFolders[fullpath] = {
    folder: folder,
    lastModification: lastModification
  };
  return module.exports.resetTimeout();
};

module.exports.resetTimeout = function() {
  if (timeout != null) {
    clearTimeout(timeout);
  }
  return timeout = setTimeout(module.exports.flush, 60 * 1000);
};

module.exports.flush = function(callback) {
  var folders;
  folders = parentFolders;
  parentFolders = {};
  return async.forEachOfSeries(folders, function(entry, fullpath, done) {
    var data;
    data = {
      lastModification: entry.lastModification
    };
    return entry.folder.updateAttributes(data, function(err) {
      if (err != null) {
        log.error(err);
      }
      return done();
    });
  }, callback);
};
